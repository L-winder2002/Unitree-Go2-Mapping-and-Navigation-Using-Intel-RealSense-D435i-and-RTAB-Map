/rtabmap/rtabmap:
  ros__parameters:

    #######################################################
    # === 栅格地图 (Occupancy Grid) 相关参数 ===
    #######################################################

    # 单元格大小（米）
    # 控制地图分辨率，值越大 → 地图更粗糙，占用内存更少。
    # 默认: 0.05
    "Grid/CellSize": "0.05"
    "Grid/MaxObstacleHeight": "1.5" # 超过 1.5m 的当作“无关高处”
    # 最小和最大深度范围（单位：米）
    # 用于生成占据栅格时忽略太近或太远的点。
    "Grid/RangeMin": "0.1"
    "Grid/RangeMax": "4.0"

    # 启用法线分割，用于区分地面和平面障碍物。
    # true 表示启用。
    "Grid/NormalsSegmentation": "true"


    # 噪声过滤半径（米）
    # 过滤孤立点的邻域半径。
    "Grid/NoiseFilteringRadius": "0.1"

    # 噪声过滤时的最小邻居数
    # 小于该值的点将被认为是噪声。
    "Grid/NoiseFilteringMinNeighbors": "2"

    # 最小聚类点数，小于该值的障碍点云将被忽略。
    "Grid/MinClusterSize": "10"

    # 是否使用光线追踪来填充自由空间（true = 开启自由空间填充）
    "Grid/RayTracing": "true"

    #######################################################
    # === 全局地图合并与节点控制 ===
    #######################################################

    # 全局地图中最多保留的节点数
    # 限制图优化时的关键帧数量，防止内存过大。
    # 默认: 0（不限制）
    "GridGlobal/MaxNodes": "1000"

    # 地图融合时允许的最大高度差（米）
    # 超过该差值的点不会被合并。
    "GridGlobal/AltitudeDelta": "0.1"

    # 栅格融合时的腐蚀（像素）
    # 用于防止边缘错误。
    "GridGlobal/Eroded": "true"

    #######################################################
    # === 特征提取与视觉匹配参数 ===
    #######################################################

    # 最大特征点数量
    # 越多匹配越稳定，但CPU消耗增加。
    "Kp/MaxFeatures": "400"

    # 最小匹配内点数
    # 低于该阈值的帧将被认为匹配失败。
    "Vis/MinInliers": "12"

    #######################################################
    # === 内存与关键帧管理 ===
    #######################################################

    # 检测频率（Hz）
    # 控制每秒处理的关键帧数量。
    "Rtabmap/DetectionRate": "1.0"

    # 平移阈值：机器人移动超过该距离时才创建新关键帧。
    "RGBD/LinearUpdate": "0.2"

    # 旋转阈值（弧度）：旋转超过该角度时才创建新关键帧。
    "RGBD/AngularUpdate": "0.2"

    # 允许的最大关键帧数
    # 超过该值后将自动丢弃旧帧。
    "Rtabmap/MemoryThr": "1500"

    #######################################################
    # === 点云降采样与性能优化 ===
    #######################################################

    # 深度图降采样步长（越大越快，但精度下降）
    "Grid/DepthDecimation": "4"

    # 是否进行预体素滤波（true 表示启用降采样）
    "Grid/PreVoxelFiltering": "true"

    # 点云体素滤波大小（米）
    # 越大 → 降采样越强，点数减少。
    "Icp/VoxelSize": "0.05"

    #######################################################
    # === 回环检测与SLAM优化 ===
    #######################################################

    # 回环检测阈值（匹配相似度）
    "Rtabmap/LoopThr": "0.11"

    # 回环时图优化最大迭代次数
    "Optimizer/Iterations": "100"

    # 是否启用鲁棒核，防止异常约束影响优化
    "Optimizer/Robust": "true"
